"""
ü§ñ –ü–†–ò–ú–ï–†–´: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API —Å GPT
–†–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ChatGPT/Claude
"""

import requests
import json
import openai

# ================================================================
# –ù–ê–°–¢–†–û–ô–ö–ò
# ================================================================

API_BASE_URL = "http://localhost:8000"  # –ò–ª–∏ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
OPENAI_API_KEY = "your-openai-api-key"  # –í–∞—à –∫–ª—é—á OpenAI

openai.api_key = OPENAI_API_KEY

# ================================================================
# –ü–†–ò–ú–ï–† 1: –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ + GPT –∞–Ω–∞–ª–∏–∑
# ================================================================

def example_1_simple_search_and_analyze():
    """
    1. –ü–æ–ª—É—á–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏ —á–µ—Ä–µ–∑ API
    2. GPT –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–µ
    """
    
    print("=" * 60)
    print("üîç –ü–†–ò–ú–ï–† 1: –ü–æ–∏—Å–∫ + GPT –∞–Ω–∞–ª–∏–∑")
    print("=" * 60)
    
    # 1. –ü–æ–ª—É—á–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏
    response = requests.post(
        f"{API_BASE_URL}/api/search",
        json={
            "keywords": "–æ–ø–µ—Ä–∞—Ç–æ—Ä CRM –≤—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏",
            "region": 1,
            "min_salary": 50000,
            "only_with_salary": True,
            "period": 7,
            "max_results": 50
        }
    )
    
    data = response.json()
    
    if not data['success']:
        print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ")
        return
    
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ: {data['count']} –≤–∞–∫–∞–Ω—Å–∏–π")
    
    # 2. –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 10 –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
    vacancies_for_gpt = data['vacancies'][:10]
    
    # 3. –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç –¥–ª—è GPT
    vacancies_text = ""
    for i, v in enumerate(vacancies_for_gpt, 1):
        vacancies_text += f"""
{i}. {v['–Ω–∞–∑–≤–∞–Ω–∏–µ']}
   –ö–æ–º–ø–∞–Ω–∏—è: {v['–∫–æ–º–ø–∞–Ω–∏—è']}
   –ó–∞—Ä–ø–ª–∞—Ç–∞: {v['–æ–ø–ª–∞—Ç–∞']}
   –û–ø–∏—Å–∞–Ω–∏–µ: {v['–æ–ø–∏—Å–∞–Ω–∏–µ'][:300]}...
   –°—Å—ã–ª–∫–∞: {v['—Å—Å—ã–ª–∫–∞']}
---
"""
    
    prompt = f"""
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–∏ {len(vacancies_for_gpt)} –≤–∞–∫–∞–Ω—Å–∏–π –∏ –≤—ã–±–µ—Ä–∏ –¢–û–ü-3 —Å–∞–º—ã—Ö –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞, 
–∫–æ—Ç–æ—Ä—ã–π –∏—â–µ—Ç —Ä–∞–±–æ—Ç—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –ø–æ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫ —á–µ—Ä–µ–∑ CRM.

–ö—Ä–∏—Ç–µ—Ä–∏–∏:
1. –ß–µ—Ç–∫–æ —É–∫–∞–∑–∞–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å –≤—Ö–æ–¥—è—â–∏–º–∏ –∑–∞—è–≤–∫–∞–º–∏
2. –ï—Å—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ CRM —Å–∏—Å—Ç–µ–º—ã
3. –ê–¥–µ–∫–≤–∞—Ç–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ (–æ—Ç 50–∫)
4. –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Ç—Ä—É–¥–∞
5. –ù–µ –ø—Ä–æ–¥–∞–∂–∏

–í–ê–ö–ê–ù–°–ò–ò:
{vacancies_text}

–û—Ç–≤–µ—Ç –¥–∞–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
ü•á –ú–ï–°–¢–û 1: [–ù–∞–∑–≤–∞–Ω–∏–µ]
   –ö–æ–º–ø–∞–Ω–∏—è: ...
   –ó–∞—Ä–ø–ª–∞—Ç–∞: ...
   –ü–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç: ...
   –°—Å—ã–ª–∫–∞: ...
"""
    
    # 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º GPT
    print("\nü§ñ GPT –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–∏...")
    
    client = openai.OpenAI(api_key=OPENAI_API_KEY)
    
    completion = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø–æ–¥–±–æ—Ä—É –ø–µ—Ä—Å–æ–Ω–∞–ª–∞. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –ø–æ–º–æ–≥–∞–µ—à—å –ª—é–¥—è–º –Ω–∞–π—Ç–∏ –ª—É—á—à—É—é —Ä–∞–±–æ—Ç—É."},
            {"role": "user", "content": prompt}
        ]
    )
    
    gpt_response = completion.choices[0].message.content
    
    print("\n" + "=" * 60)
    print("üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò GPT:")
    print("=" * 60)
    print(gpt_response)
    
    return gpt_response


# ================================================================
# –ü–†–ò–ú–ï–† 2: GPT –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å ‚Üí API ‚Üí GPT —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
# ================================================================

def example_2_gpt_query_generation():
    """
    –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª:
    1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
    2. GPT –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ API –∑–∞–ø—Ä–æ—Å
    3. API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–∏
    4. GPT —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
    """
    
    print("\n" + "=" * 60)
    print("üîÑ –ü–†–ò–ú–ï–† 2: GPT ‚Üí API ‚Üí GPT")
    print("=" * 60)
    
    # 1. –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
    user_query = "–ù–∞–π–¥–∏ –º–Ω–µ —Ä–∞–±–æ—Ç—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –≤ –ú–æ—Å–∫–≤–µ, –∑–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç 60 —Ç—ã—Å—è—á, —Ç–æ–ª—å–∫–æ —Å–≤–µ–∂–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏"
    
    print(f"\nüë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_query}")
    
    # 2. GPT –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ API –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    client = openai.OpenAI(api_key=OPENAI_API_KEY)
    
    convert_prompt = f"""
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –Ω–∞–π—Ç–∏ –≤–∞–∫–∞–Ω—Å–∏–∏: "{user_query}"

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π —ç—Ç–æ –≤ JSON –¥–ª—è API –∑–∞–ø—Ä–æ—Å–∞:
{{
  "keywords": "...",
  "region": 1 or 2 or 113,
  "min_salary": —á–∏—Å–ª–æ –∏–ª–∏ null,
  "only_with_salary": true/false,
  "period": 1 or 3 or 7 or 30,
  "max_results": 50-200
}}

–†–µ–≥–∏–æ–Ω—ã: 1=–ú–æ—Å–∫–≤–∞, 2=–°–ü–±, 113=–†–æ—Å—Å–∏—è
–ü–µ—Ä–∏–æ–¥: 1=–¥–µ–Ω—å, 3=3–¥–Ω—è, 7=–Ω–µ–¥–µ–ª—è, 30=–º–µ—Å—è—Ü

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û JSON, –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏–π.
"""
    
    completion = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "–¢—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—à—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ JSON –¥–ª—è API."},
            {"role": "user", "content": convert_prompt}
        ]
    )
    
    api_params_text = completion.choices[0].message.content
    
    # –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
    import re
    json_match = re.search(r'\{.*\}', api_params_text, re.DOTALL)
    if json_match:
        api_params = json.loads(json_match.group())
    else:
        api_params = json.loads(api_params_text)
    
    print(f"\nü§ñ GPT —Å–æ–∑–¥–∞–ª –∑–∞–ø—Ä–æ—Å: {json.dumps(api_params, ensure_ascii=False, indent=2)}")
    
    # 3. –í—ã–∑—ã–≤–∞–µ–º API
    print("\nüì° –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –∫ API...")
    response = requests.post(
        f"{API_BASE_URL}/api/search",
        json=api_params
    )
    
    data = response.json()
    
    if not data['success']:
        print("‚ùå –û—à–∏–±–∫–∞ API")
        return
    
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ: {data['count']} –≤–∞–∫–∞–Ω—Å–∏–π")
    
    # 4. GPT —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–π –æ—Ç–≤–µ—Ç
    top_vacancies = data['vacancies'][:5]
    
    format_prompt = f"""
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–∫–∞–ª: "{user_query}"

–ù–∞–π–¥–µ–Ω–æ {data['count']} –≤–∞–∫–∞–Ω—Å–∏–π. –í–æ—Ç —Ç–æ–ø-5:

{json.dumps(top_vacancies, ensure_ascii=False, indent=2)}

–°—Ñ–æ—Ä–º–∏—Ä—É–π –∫—Ä–∞—Å–∏–≤—ã–π, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
1. –°–∫–∞–∂–∏ —Å–∫–æ–ª—å–∫–æ –Ω–∞—à–ª–∏
2. –ü–æ–∫–∞–∂–∏ —Ç–æ–ø-3 –≤–∞–∫–∞–Ω—Å–∏–∏ —Å –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ–π
3. –î–∞–π —Å–æ–≤–µ—Ç —Å—Ç–æ–∏—Ç –ª–∏ –æ—Ç–∫–ª–∏–∫–∞—Ç—å—Å—è
4. –î–æ–±–∞–≤—å —ç–º–æ–¥–∑–∏ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã
"""
    
    completion = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "–¢—ã –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –ø–æ–∏—Å–∫—É —Ä–∞–±–æ—Ç—ã."},
            {"role": "user", "content": format_prompt}
        ]
    )
    
    final_response = completion.choices[0].message.content
    
    print("\n" + "=" * 60)
    print("üí¨ –û–¢–í–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ:")
    print("=" * 60)
    print(final_response)
    
    return final_response


# ================================================================
# –ü–†–ò–ú–ï–† 3: GPT –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ
# ================================================================

def example_3_generate_cover_letter():
    """
    1. –ü–æ–ª—É—á–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏—é
    2. GPT –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ
    """
    
    print("\n" + "=" * 60)
    print("‚úâÔ∏è –ü–†–ò–ú–ï–† 3: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∏—Å—å–º–∞")
    print("=" * 60)
    
    # 1. –ü–æ–ª—É—á–∞–µ–º –æ–¥–Ω—É –≤–∞–∫–∞–Ω—Å–∏—é
    response = requests.post(
        f"{API_BASE_URL}/api/search-quick",
        params={
            "keywords": "–æ–ø–µ—Ä–∞—Ç–æ—Ä CRM",
            "region": 1,
            "max_results": 1
        }
    )
    
    data = response.json()
    
    if not data['success'] or not data['vacancies']:
        print("‚ùå –í–∞–∫–∞–Ω—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã")
        return
    
    vacancy = data['vacancies'][0]
    
    print(f"üìã –í–∞–∫–∞–Ω—Å–∏—è: {vacancy['–Ω–∞–∑–≤–∞–Ω–∏–µ']}")
    print(f"üè¢ –ö–æ–º–ø–∞–Ω–∏—è: {vacancy['–∫–æ–º–ø–∞–Ω–∏—è']}")
    
    # 2. –†–µ–∑—é–º–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ (–ø—Ä–∏–º–µ—Ä)
    candidate_info = """
–ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
–û–ø—ã—Ç: 2 –≥–æ–¥–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º call-—Ü–µ–Ω—Ç—Ä–∞
–ù–∞–≤—ã–∫–∏: 
- –†–∞–±–æ—Ç–∞ —Å CRM (–ë–∏—Ç—Ä–∏–∫—Å24)
- –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫
- –ì—Ä–∞–º–æ—Ç–Ω–∞—è —Ä–µ—á—å
- –°—Ç—Ä–µ—Å—Å–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
–û —Å–µ–±–µ: –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π –∫ –¥–µ—Ç–∞–ª—è–º, –ª—é–±–ª—é –ø–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º.
"""
    
    # 3. GPT –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∏—Å—å–º–æ
    client = openai.OpenAI(api_key=OPENAI_API_KEY)
    
    prompt = f"""
–ù–∞–ø–∏—à–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø–∏—Å—å–º–æ –¥–ª—è –æ—Ç–∫–ª–∏–∫–∞ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é.

–í–ê–ö–ê–ù–°–ò–Ø:
–ù–∞–∑–≤–∞–Ω–∏–µ: {vacancy['–Ω–∞–∑–≤–∞–Ω–∏–µ']}
–ö–æ–º–ø–∞–Ω–∏—è: {vacancy['–∫–æ–º–ø–∞–Ω–∏—è']}
–û–ø–∏—Å–∞–Ω–∏–µ: {vacancy['–æ–ø–∏—Å–∞–Ω–∏–µ'][:500]}

–ö–ê–ù–î–ò–î–ê–¢:
{candidate_info}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∏—Å—å–º—É:
- –ö–æ—Ä–æ—Ç–∫–æ–µ (200-300 —Å–ª–æ–≤)
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ, –Ω–æ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ
- –ü–æ–¥—á–µ—Ä–∫–Ω–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- –ü–æ–∫–∞–∂–∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é
- –ë–µ–∑ —à–∞–±–ª–æ–Ω–Ω—ã—Ö —Ñ—Ä–∞–∑
"""
    
    completion = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∏—Å–µ–º. –ü–∏—à–µ—à—å —É–±–µ–¥–∏—Ç–µ–ª—å–Ω–æ –∏ –∏—Å–∫—Ä–µ–Ω–Ω–µ."},
            {"role": "user", "content": prompt}
        ]
    )
    
    cover_letter = completion.choices[0].message.content
    
    print("\n" + "=" * 60)
    print("‚úâÔ∏è –°–û–ü–†–û–í–û–î–ò–¢–ï–õ–¨–ù–û–ï –ü–ò–°–¨–ú–û:")
    print("=" * 60)
    print(cover_letter)
    print("=" * 60)
    
    return cover_letter


# ================================================================
# –ü–†–ò–ú–ï–† 4: GPT —Ä–∞–Ω–∂–∏—Ä—É–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
# ================================================================

def example_4_rank_vacancies():
    """
    1. –ü–æ–ª—É—á–∞–µ–º –º–Ω–æ–≥–æ –≤–∞–∫–∞–Ω—Å–∏–π
    2. GPT —Ä–∞–Ω–∂–∏—Ä—É–µ—Ç –∏—Ö –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
    """
    
    print("\n" + "=" * 60)
    print("üèÜ –ü–†–ò–ú–ï–† 4: –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–π")
    print("=" * 60)
    
    # 1. –ü–æ–ª—É—á–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏
    response = requests.post(
        f"{API_BASE_URL}/api/search",
        json={
            "keywords": "–º–µ–Ω–µ–¥–∂–µ—Ä CRM",
            "region": 1,
            "min_salary": 50000,
            "only_with_salary": True,
            "period": 7,
            "max_results": 20
        }
    )
    
    data = response.json()
    
    if not data['success']:
        print("‚ùå –û—à–∏–±–∫–∞")
        return
    
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω–æ: {data['count']} –≤–∞–∫–∞–Ω—Å–∏–π")
    
    # 2. –ü—Ä–æ—Ñ–∏–ª—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
    candidate_profile = """
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
1. –£–¥–∞–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –∏–ª–∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
2. –ó–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç 70–∫
3. –ö–æ–º–ø–∞–Ω–∏—è —Å –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–º–∏ –æ—Ç–∑—ã–≤–∞–º–∏
4. –ù–µ —Ö–æ–ª–æ–¥–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏
5. –ï—Å—Ç—å CRM —Å–∏—Å—Ç–µ–º–∞
6. –í—Ö–æ–¥—è—â–∏–µ –ª–∏–¥—ã, –Ω–µ —Ö–æ–ª–æ–¥–Ω–∞—è –±–∞–∑–∞
"""
    
    # 3. –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è GPT
    vacancies_brief = []
    for i, v in enumerate(data['vacancies'][:15], 1):
        vacancies_brief.append({
            "index": i,
            "–Ω–∞–∑–≤–∞–Ω–∏–µ": v['–Ω–∞–∑–≤–∞–Ω–∏–µ'],
            "–∫–æ–º–ø–∞–Ω–∏—è": v['–∫–æ–º–ø–∞–Ω–∏—è'],
            "–æ–ø–ª–∞—Ç–∞": v['–æ–ø–ª–∞—Ç–∞'],
            "–æ–ø–∏—Å–∞–Ω–∏–µ_–∫—Ä–∞—Ç–∫–æ–µ": v['–æ–ø–∏—Å–∞–Ω–∏–µ'][:200]
        })
    
    # 4. GPT —Ä–∞–Ω–∂–∏—Ä—É–µ—Ç
    client = openai.OpenAI(api_key=OPENAI_API_KEY)
    
    prompt = f"""
–ü—Ä–æ—Ä–∞–Ω–∂–∏—Ä—É–π —ç—Ç–∏ –≤–∞–∫–∞–Ω—Å–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.

–ü–†–ò–û–†–ò–¢–ï–¢–´ –ö–ê–ù–î–ò–î–ê–¢–ê:
{candidate_profile}

–í–ê–ö–ê–ù–°–ò–ò:
{json.dumps(vacancies_brief, ensure_ascii=False, indent=2)}

–í—ã–¥–∞–π —Ç–æ–ø-5 –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
1. [Index –≤–∞–∫–∞–Ω—Å–∏–∏] - [–ù–∞–∑–≤–∞–Ω–∏–µ] - [–ü–æ—á–µ–º—É –Ω–∞ —ç—Ç–æ–º –º–µ—Å—Ç–µ]
2. ...

–£—á–∏—Ç—ã–≤–∞–π –í–°–ï –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∫–∞–Ω–¥–∏–¥–∞—Ç–∞.
"""
    
    completion = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "–¢—ã –∫–∞—Ä—å–µ—Ä–Ω—ã–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –ø–æ–¥–±–∏—Ä–∞–µ—à—å –ª—É—á—à–∏–µ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞."},
            {"role": "user", "content": prompt}
        ]
    )
    
    ranking = completion.choices[0].message.content
    
    print("\n" + "=" * 60)
    print("üèÜ –†–ê–ù–ñ–ò–†–û–í–ê–ù–ò–ï:")
    print("=" * 60)
    print(ranking)
    
    return ranking


# ================================================================
# –ü–†–ò–ú–ï–† 5: Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ - GPT –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–∞–Ω–∏–∏
# ================================================================

def example_5_batch_company_analysis():
    """
    1. –ü–æ–ª—É—á–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏
    2. –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º
    3. GPT –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é –∫–æ–º–ø–∞–Ω–∏—é
    """
    
    print("\n" + "=" * 60)
    print("üè¢ –ü–†–ò–ú–ï–† 5: –ê–Ω–∞–ª–∏–∑ –∫–æ–º–ø–∞–Ω–∏–π")
    print("=" * 60)
    
    # 1. –ü–æ–ª—É—á–∞–µ–º –≤–∞–∫–∞–Ω—Å–∏–∏
    response = requests.post(
        f"{API_BASE_URL}/api/search",
        json={
            "keywords": "–æ–ø–µ—Ä–∞—Ç–æ—Ä –≤—Ö–æ–¥—è—â–∏–µ",
            "region": 1,
            "max_results": 100
        }
    )
    
    data = response.json()
    
    # 2. –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º
    from collections import defaultdict
    
    companies = defaultdict(list)
    for v in data['vacancies']:
        companies[v['–∫–æ–º–ø–∞–Ω–∏—è']].append(v)
    
    # 3. –¢–æ–ø-5 –∫–æ–º–ø–∞–Ω–∏–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤–∞–∫–∞–Ω—Å–∏–π
    top_companies = sorted(companies.items(), key=lambda x: len(x[1]), reverse=True)[:5]
    
    print(f"\nüìä –¢–æ–ø-5 –∫–æ–º–ø–∞–Ω–∏–π —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–∞–∫–∞–Ω—Å–∏–π:")
    
    for company_name, vacancies in top_companies:
        print(f"\nüè¢ {company_name} ({len(vacancies)} –≤–∞–∫–∞–Ω—Å–∏–π)")
        
        # –ë–µ—Ä–µ–º –æ–¥–Ω—É –≤–∞–∫–∞–Ω—Å–∏—é –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        sample_vacancy = vacancies[0]
        
        # GPT –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–º–ø–∞–Ω–∏—é
        client = openai.OpenAI(api_key=OPENAI_API_KEY)
        
        prompt = f"""
–ö–æ–º–ø–∞–Ω–∏—è "{company_name}" —Ä–∞–∑–º–µ—Å—Ç–∏–ª–∞ {len(vacancies)} –≤–∞–∫–∞–Ω—Å–∏–π.

–ü—Ä–∏–º–µ—Ä –≤–∞–∫–∞–Ω—Å–∏–∏:
{sample_vacancy['–Ω–∞–∑–≤–∞–Ω–∏–µ']}
–ó–∞—Ä–ø–ª–∞—Ç–∞: {sample_vacancy['–æ–ø–ª–∞—Ç–∞']}
–û–ø–∏—Å–∞–Ω–∏–µ: {sample_vacancy['–æ–ø–∏—Å–∞–Ω–∏–µ'][:300]}

–î–∞–π –∫—Ä–∞—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è):
- –ß—Ç–æ –∑–∞ –∫–æ–º–ø–∞–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ
- –°—Ç–æ–∏—Ç –ª–∏ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å
- –ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
"""
        
        completion = client.chat.completions.create(
            model="gpt-4",
            messages=[
                {"role": "system", "content": "–¢—ã HR —ç–∫—Å–ø–µ—Ä—Ç, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—à—å –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ –≤–∞–∫–∞–Ω—Å–∏—è–º."},
                {"role": "user", "content": prompt}
            ]
        )
        
        analysis = completion.choices[0].message.content
        print(f"   üí¨ {analysis}")


# ================================================================
# –ó–ê–ü–£–°–ö –ü–†–ò–ú–ï–†–û–í
# ================================================================

if __name__ == "__main__":
    print("=" * 60)
    print("ü§ñ –ü–†–ò–ú–ï–†–´ –ò–ù–¢–ï–ì–†–ê–¶–ò–ò API + GPT")
    print("=" * 60)
    print("\n–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä:")
    print("1 - –ü–æ–∏—Å–∫ + GPT –∞–Ω–∞–ª–∏–∑")
    print("2 - GPT ‚Üí API ‚Üí GPT (–ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª)")
    print("3 - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–ø—Ä–æ–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∏—Å—å–º–∞")
    print("4 - –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–π")
    print("5 - –ê–Ω–∞–ª–∏–∑ –∫–æ–º–ø–∞–Ω–∏–π")
    
    choice = input("\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (Enter = –≤—Å–µ): ").strip()
    
    if choice == "1":
        example_1_simple_search_and_analyze()
    elif choice == "2":
        example_2_gpt_query_generation()
    elif choice == "3":
        example_3_generate_cover_letter()
    elif choice == "4":
        example_4_rank_vacancies()
    elif choice == "5":
        example_5_batch_company_analysis()
    else:
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã
        example_1_simple_search_and_analyze()
        example_2_gpt_query_generation()
        example_3_generate_cover_letter()
        example_4_rank_vacancies()
        example_5_batch_company_analysis()
    
    print("\n" + "=" * 60)
    print("‚úÖ –ì–û–¢–û–í–û!")
    print("=" * 60)


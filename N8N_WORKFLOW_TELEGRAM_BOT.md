# üîÑ N8N WORKFLOW - Telegram –±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π

## –°–•–ï–ú–ê WORKFLOW:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Trigger    ‚îÇ ‚Üê –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ OpenAI Chat         ‚îÇ ‚Üê AI-–∞–≥–µ–Ω—Ç (System Message)
‚îÇ (—Å Function Call)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HTTP Request        ‚îÇ ‚Üê –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≥–µ–Ω—Ç–æ–º
‚îÇ (Railway API)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ OpenAI Chat         ‚îÇ ‚Üê –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
‚îÇ (–ê–Ω–∞–ª–∏–∑)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Telegram Send       ‚îÇ ‚Üê –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ù–ê–°–¢–†–û–ô–ö–ê –£–ó–õ–û–í:

### 1Ô∏è‚É£ TELEGRAM TRIGGER

**Settings:**
- Event: Message received
- Download Images/Files: No

**Output:**
```json
{
  "message": {
    "text": "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–∞—è–≤–∫–∏ –≤ CRM, –æ—Ç 60–∫",
    "chat": {
      "id": 123456789
    }
  }
}
```

---

### 2Ô∏è‚É£ OPENAI CHAT (Agent)

**Model:** gpt-4-turbo-preview –∏–ª–∏ gpt-4

**System Message:** (–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏–∑ SYSTEM_PROMPT_–ö–†–ê–¢–ö–ò–ô.md)

```
–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –ø–æ–∏—Å–∫—É –≤–∞–∫–∞–Ω—Å–∏–π –Ω–∞ HH.ru —á–µ—Ä–µ–∑ API.

API: https://hhparser-production.up.railway.app/api/search (POST, JSON)

–¢–í–û–Ø –ó–ê–î–ê–ß–ê:
1. –ü—Ä–æ—á–∏—Ç–∞–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ò–∑–≤–ª–µ–∫–∏: –Ω–∞–≤—ã–∫–∏, –∑–∞—Ä–ø–ª–∞—Ç—É, —Ä–µ–≥–∏–æ–Ω, —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
3. –°—Ñ–æ—Ä–º–∏—Ä—É–π JSON –∑–∞–ø—Ä–æ—Å –∫ API
4. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
5. –í—ã–¥–∞–π –¢–û–ü-5 –ª—É—á—à–∏—Ö –≤–∞–∫–∞–Ω—Å–∏–π —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º

–ü–ê–†–ê–ú–ï–¢–†–´ API:
{
  "keywords": "–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞",
  "region": 1,
  "min_salary": 50000,
  "only_with_salary": true,
  "period": 7,
  "excluded_words": "–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –±—Ä–æ–∫–µ—Ä",
  "sort_by": "publication_time",
  "max_results": 100
}

–ü–†–ê–í–ò–õ–ê:
- keywords: –≥–ª–∞–≤–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ + —Å–∏–Ω–æ–Ω–∏–º—ã
- min_salary: –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ ‚Üí 40-80–∫ –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏
- only_with_salary: –≤—Å–µ–≥–¥–∞ true
- excluded_words: –±–∞–∑–æ–≤—ã–µ + —Ç–æ —á—Ç–æ –ù–ï —Ö–æ—á–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
üéØ –¢–û–ü-5 —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º
```

**User Message:**
```
{{ $json.message.text }}
```

**Options:**
- Enable Function Calling: ‚úÖ
- Temperature: 0.7
- Max Tokens: 4000

**Functions/Tools:**
```json
{
  "name": "search_vacancies",
  "description": "–ü–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π —á–µ—Ä–µ–∑ HH.ru API",
  "parameters": {
    "type": "object",
    "properties": {
      "keywords": {
        "type": "string",
        "description": "–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞"
      },
      "region": {
        "type": "integer",
        "description": "ID —Ä–µ–≥–∏–æ–Ω–∞ (1=–ú–æ—Å–∫–≤–∞, 2=–°–ü–±, 113=–†–æ—Å—Å–∏—è)"
      },
      "min_salary": {
        "type": "integer",
        "description": "–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞"
      },
      "only_with_salary": {
        "type": "boolean",
        "description": "–¢–æ–ª—å–∫–æ —Å —É–∫–∞–∑–∞–Ω–Ω–æ–π –∑–∞—Ä–ø–ª–∞—Ç–æ–π"
      },
      "period": {
        "type": "integer",
        "description": "–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π (1,3,7,30)"
      },
      "excluded_words": {
        "type": "string",
        "description": "–°–ª–æ–≤–∞ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è"
      },
      "sort_by": {
        "type": "string",
        "description": "–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞"
      },
      "max_results": {
        "type": "integer",
        "description": "–ú–∞–∫—Å–∏–º—É–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"
      }
    },
    "required": ["keywords"]
  }
}
```

---

### 3Ô∏è‚É£ HTTP REQUEST

**Method:** POST

**URL:**
```
https://hhparser-production.up.railway.app/api/search
```

**Authentication:** None

**Send Headers:** ‚úÖ

**Headers:**
```
Content-Type: application/json
```

**Send Body:** ‚úÖ

**Body Content Type:** JSON

**Body (JSON):**
```json
{
  "keywords": "{{ $json.keywords }}",
  "region": {{ $json.region }},
  "min_salary": {{ $json.min_salary }},
  "only_with_salary": {{ $json.only_with_salary }},
  "period": {{ $json.period }},
  "excluded_words": "{{ $json.excluded_words }}",
  "sort_by": "{{ $json.sort_by }}",
  "max_results": {{ $json.max_results }}
}
```

**Options:**
- Timeout: 120000 (2 –º–∏–Ω—É—Ç—ã)
- Follow Redirects: ‚úÖ

---

### 4Ô∏è‚É£ OPENAI CHAT (Formatter)

**Model:** gpt-4-turbo-preview

**System Message:**
```
–¢—ã –ø–æ–ª—É—á–∏–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π —á–µ—Ä–µ–∑ API.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
1. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å data.vacancies
2. –í—ã–±—Ä–∞—Ç—å –¢–û–ü-5 –ª—É—á—à–∏—Ö –≤–∞–∫–∞–Ω—Å–∏–π
3. –î–ª—è –∫–∞–∂–¥–æ–π –Ω–∞–ø–∏—Å–∞—Ç—å –ø–æ—á–µ–º—É –æ–Ω–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç
4. –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–∞—Å–∏–≤–æ –¥–ª—è Telegram

–§–æ—Ä–º–∞—Ç:
üìä **–°–¢–ê–¢–ò–°–¢–ò–ö–ê**
–ù–∞–π–¥–µ–Ω–æ: {count} –≤–∞–∫–∞–Ω—Å–∏–π

üéØ **–¢–û–ü-5 –í–ê–ö–ê–ù–°–ò–ô:**

**1. [–ù–∞–∑–≤–∞–Ω–∏–µ]**
üè¢ [–ö–æ–º–ø–∞–Ω–∏—è]
üí∞ [–ó–∞—Ä–ø–ª–∞—Ç–∞]
üìã [–û–ø—ã—Ç]

**–ü–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç:**
[2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏—è]

üîó [–°—Å—ã–ª–∫–∞]

---

[–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è 2-5]

üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** [—Å–æ–≤–µ—Ç—ã]
```

**User Message:**
```
–ò—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ $('Telegram Trigger').item.json.message.text }}

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã API:
{{ JSON.stringify($json) }}

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ –≤—ã–¥–∞–π —Ç–æ–ø-5 –≤–∞–∫–∞–Ω—Å–∏–π —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º –¥–ª—è –∫–∞–∂–¥–æ–π.
```

**Options:**
- Temperature: 0.8
- Max Tokens: 3000

---

### 5Ô∏è‚É£ TELEGRAM SEND MESSAGE

**Chat ID:**
```
{{ $('Telegram Trigger').item.json.message.chat.id }}
```

**Text:**
```
{{ $json.choices[0].message.content }}
```

**Additional Fields:**
- Parse Mode: Markdown
- Disable Web Page Preview: ‚úÖ

---

## –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–´–ô –£–ü–†–û–©–ï–ù–ù–´–ô WORKFLOW:

–ï—Å–ª–∏ OpenAI Function Calling –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç:

```
[Telegram] ‚Üí [Set] ‚Üí [OpenAI] ‚Üí [Code] ‚Üí [HTTP] ‚Üí [OpenAI] ‚Üí [Telegram]
```

### CODE –£–ó–ï–õ (–≤–º–µ—Å—Ç–æ Function Calling):

```javascript
// –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ GPT
const gptResponse = items[0].json.choices[0].message.content;

// –ü–∞—Ä—Å–∏–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞ GPT (–µ—Å–ª–∏ GPT –≤–µ—Ä–Ω—É–ª JSON)
const params = JSON.parse(gptResponse);

return [{
  json: {
    keywords: params.keywords || "–æ–ø–µ—Ä–∞—Ç–æ—Ä CRM",
    region: params.region || 1,
    min_salary: params.min_salary || 50000,
    only_with_salary: true,
    period: 7,
    excluded_words: params.excluded_words || "–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –±—Ä–æ–∫–µ—Ä",
    sort_by: "publication_time",
    max_results: 100
  }
}];
```

---

## –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï:

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:

1. **–ü—Ä–æ—Å—Ç–æ–π:**
   ```
   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–∞—è–≤–∫–∏ –≤ CRM, —Ö–æ—á—É –æ—Ç 60–∫
   ```

2. **–î–µ—Ç–∞–ª—å–Ω—ã–π:**
   ```
   –Ø SMM-–º–µ–Ω–µ–¥–∂–µ—Ä, —Ä–∞–±–æ—Ç–∞—é —Å —Ç–∞—Ä–≥–µ—Ç–æ–º –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º.
   –ù—É–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞ –≤ –ú–æ—Å–∫–≤–µ, –∑–∞—Ä–ø–ª–∞—Ç–∞ –æ—Ç 80 —Ç—ã—Å—è—á.
   –ë–µ–∑ –∞–≥–µ–Ω—Ç—Å—Ç–≤ –∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏.
   ```

3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π:**
   ```
   –ò—â—É —Ä–∞–±–æ—Ç—É –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º
   ```

---

## –í–ê–ñ–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò:

1. **Timeout –≤ HTTP Request:**
   - –ü–æ—Å—Ç–∞–≤—å—Ç–µ 120000 (2 –º–∏–Ω—É—Ç—ã)
   - –ü–∞—Ä—Å–∏–Ω–≥ –º–æ–∂–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å –≤—Ä–µ–º—è

2. **Error Handling:**
   - –î–æ–±–∞–≤—å—Ç–µ —É–∑–µ–ª "On Error" –ø–æ—Å–ª–µ HTTP Request
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã"

3. **Rate Limiting:**
   - –ï—Å–ª–∏ –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí –¥–æ–±–∞–≤—å—Ç–µ –æ—á–µ—Ä–µ–¥—å
   - –ò–ª–∏ –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (1 –∑–∞–ø—Ä–æ—Å –≤ –º–∏–Ω—É—Ç—É –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

---

## –ì–û–¢–û–í–´–ô JSON WORKFLOW (–ò–ú–ü–û–†–¢ –í N8N):

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç JSON –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ n8n:

```json
{
  "name": "Telegram Vacancy Search Bot",
  "nodes": [
    {
      "parameters": {},
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "model": "gpt-4-turbo-preview",
        "messages": {
          "messageValues": [
            {
              "role": "system",
              "content": "–¢—ã ‚Äî –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –ø–æ –ø–æ–∏—Å–∫—É –≤–∞–∫–∞–Ω—Å–∏–π..."
            },
            {
              "role": "user",
              "content": "={{ $json.message.text }}"
            }
          ]
        }
      },
      "name": "OpenAI Agent",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "url": "https://hhparser-production.up.railway.app/api/search",
        "method": "POST",
        "jsonParameters": true,
        "bodyParametersJson": "={{ JSON.stringify($json.function_call.arguments) }}"
      },
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [650, 300]
    },
    {
      "parameters": {
        "model": "gpt-4-turbo-preview",
        "messages": {
          "messageValues": [
            {
              "role": "user",
              "content": "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –≤—ã–¥–∞–π —Ç–æ–ø-5: {{ JSON.stringify($json) }}"
            }
          ]
        }
      },
      "name": "OpenAI Formatter",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.choices[0].message.content }}"
      },
      "name": "Telegram Send",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1050, 300]
    }
  ]
}
```

---

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –≤—Å—ë –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–∞! üöÄ

